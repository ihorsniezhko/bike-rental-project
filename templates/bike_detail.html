{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <img src="{{ bike.featured_image.url }}" class="img-fluid" alt="{{ bike.name }}">
        </div>
        <div class="col-md-4">
            <h2 class="text-primary-emphasis">{{ bike.name }}</h2>
            <p>
                Type: {{ bike.type }} <br>
                Size: {{ bike.size }} <br>
                Price: <strong>â‚¬{{ bike.price_per_hour }}</strong> per hour
            </p>
            <hr>
            <h3 class="text-primary-emphasis">Description</h3>
            <!-- Use 'safe' filter to render HTML from the Summernote -->
            <p>{{ bike.description | safe }}</p>
            <hr>

            <!-- Rent button logic -->
            {% if user.is_authenticated %}
                {% if bike.is_available %}
                    <a href="{% url 'create_rental' bike.id %}" class="btn btn-success">Rent Now</a>
                {% else %}
                    <button class="btn btn-secondary" disabled>Currently Unavailable</button>
                {% endif %}
            {% else %}
                <p><a href="{% url 'account_login' %}?next={{ request.path }}">Login</a> to rent this bike.</p>
            {% endif %}
        </div>
    </div>
<hr>
<div class="row">
    <div class="col-md-8">
        <h3 class="text-primary-emphasis">Reviews ({{ reviews.count }})</h3>
        {% for review in reviews %}
        <div class="card mb-3">
            <div class="card-body">
                <p class="card-text"><strong>Rating: {{ review.rating }}/5</strong></p>
                <p class="card-text">{{ review.comment | safe }}</p>

                <footer class="blockquote-footer">
                  {% if review.user.first_name and review.user.last_name %}
                    By {{ review.user.first_name }} {{ review.user.last_name }}
                  {% else %}
                    By {{ review.user.username }}
                  {% endif %}
                  on {{ review.created_at|date:"F d, Y" }}
                </footer>
                <!-- Links to edit and delete review URL -->
                {% if request.user == review.user %}
                    <div>
                        <a href="{% url 'edit_review' review.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                        <a href="{% url 'delete_review' review.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
                        </div>
                    {% endif %}
                </div>
        </div>
        {% empty %}
            <p>No reviews yet. Be the first to leave one!</p>
        {% endfor %}
    </div>
    <div class="col-md-4">
        {% if user.is_authenticated %}
            <h3 class="text-primary-emphasis">Leave a Review</h3>
            <form method="post" novalidate>
                {{ review_form.media }}
                {% csrf_token %}
                {{ review_form | crispy }}
                <button type="submit" class="btn btn-primary mt-2">Submit Review</button>
            </form>
        {% endif %}
    </div>
</div>
{% endblock %}